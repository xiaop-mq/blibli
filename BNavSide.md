# Drag,drag,dragï¼æ‹½å‡ºå“”å“©å“”å“©ä¾§è¾¹å¯¼èˆªç»„ä»¶
![](https://user-gold-cdn.xitu.io/2020/4/3/1713ded20c3ac3cf?w=658&h=370&f=jpeg&s=50087)

------------------------------------------

## ä¸€.å‰è¨€
---------------
æ–‡ç« ä¸»è¦ä»¥å®è§‚çš„å½¢å¼æ¥èŠå“”å“©å“”å“©ä¾§è¾¹å¯¼èˆªæ‹–æ‹½ç»„ä»¶ï¼Œéå¸¸é€‚åˆæ­£åœ¨æ¸è¿›å¼å­¦ä¹ VUEçš„ä½ ï¼Œé€‚å½“çš„æ¨¡ä»¿å¼€å‘é¡¹ç›®æ˜¯å‰ç«¯å­¦ä¹ å¿…é¡»è¦æœ‰çš„æŠ€èƒ½ã€‚å¤§å¤šæ•°äººéƒ½çŸ¥é“çš„æ˜¯ï¼Œé¢è¯•éœ€è¦æœ‰è‡ªå·±çš„ä½œå“ï¼Œè€Œä½œå“æœ€é‡è¦çš„ä¸æ˜¯åˆ‡é¡µé¢ï¼Œè€Œæ˜¯ï¼š<font face="é»‘ä½“" color=red>åˆ›æ–°+ç”¨æˆ·ä½“éªŒ+æ€§èƒ½ä¼˜åŒ–+æŠ€æœ¯å±•ç¤º</font> ã€‚ä½œè€…ä¹Ÿæ˜¯ä¸€ä¸ªå‰ç«¯å°ç™½ï¼Œæ­£åœ¨æ‘¸ç´¢é˜¶æ®µï¼Œæˆ‘ä»Šå¤©è®²è§£çš„æ˜¯æ¨¡ä»¿æˆ‘è§‰å¾—åšçš„ä¸é”™çš„**ä¾§è¾¹å¯¼èˆªæ **ï¼Œå¸Œæœ›å¤§å®¶æœ‰æ”¶è·ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ¥ï¼Œæ·¡é»„çš„é•¿è£™ï¼Œè“¬æ¾çš„å¤´å‘ï¼Œæ‹½æ‹½æ‹½ï¼

#### ç»„ä»¶å±•ç¤º
> è¿™æ˜¯ä¸€ä¸ªæ¨¡ä»¿è€ç‰ˆå“”å“©å“”å“©çš„ä¾§è¾¹å¯¼èˆªæ ç»„ä»¶ï¼Œéƒ¨åˆ†æ•ˆæœå¦‚ä¸‹å›¾ï¼š

![](https://user-gold-cdn.xitu.io/2020/4/3/1713e09e6e811639?w=1673&h=672&f=gif&s=3663992)

æ ¹æ®æ•ˆæœå›¾å¯ä»¥çœ‹å‡ºï¼Œç»„ä»¶æ‹¥æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š

1. å¯¼èˆªæ ä¸­çš„æ¡ç›®å…ƒç´ `item`å¯ä»¥è¿›è¡Œæ‹–æ‹½ï¼Œå¹¶ä¸”é¡µé¢ä¸“é¢˜ç»“æ„åŒæ­¥æ”¹å˜ã€‚
2. ç‚¹å‡»ä»»æ„æ¡ç›®å…ƒç´ `item`ï¼Œå¯ä»¥ç«‹å³åˆ°å…¶å¯¹åº”çš„é¡µé¢ä½ç½®ã€‚
3. å½“æµè§ˆé¡µé¢æ—¶ï¼Œç§»åŠ¨çš„æŸä¸ªä¸“é¢˜æ—¶ï¼Œæ—è¾¹çš„æ¡ç›®å…ƒç´ `item`ä¹Ÿä¼šä¸ä¹‹å¯¹åº”ã€‚


---------------


## äºŒ.å…·ä½“è®²è§£
- æ ¹æ®éœ€æ±‚ï¼šæœ¬æ–‡å°†ç®€è¿°å¯¹h5å’Œcssè¿›è¡Œç¼–å†™ï¼Œé‡ç‚¹æ˜¯å¦‚ä½•å®ç°å®æ—¶æ»šåŠ¨å¯¼èˆªå’Œæ‹–æ‹½ã€‚

### è·å–ä¸“é¢˜åç§°åŠå…¶ç›¸å…³æ•°æ®

 #### 1.é¦–å…ˆæˆ‘ä»¬è¦å»vuexé‡Œé¢æ‹¿æ•°æ®ï¼Œå®Œæˆæ˜¾ç¤ºä¸“é¢˜åç§°ï¼Œæ‹–æ‹½ç­‰åŠŸèƒ½ï¼Œéœ€è¦`sortValues`ã€`sortKeys`ä»¥åŠ`sortIds`,vuexé€šè¿‡å»è¯·æ±‚å“”å“©å“”å“©å®˜æ–¹æä¾›çš„apiè¿›è¡Œæ‹¿å–ã€‚å…·ä½“è¿‡ç¨‹æš‚ä¸”å¿½ç•¥ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼ˆå› ä¸ºè¿™ä¸ªæ˜¯ä¸€ä¸ªå…¨æ ˆé¡¹ç›®ï¼Œè€Œè¿™ä¸ªç»„ä»¶å’Œå…¶ä»–ç»„ä»¶çš„å…³è”ç¨‹åº¦æœ€å¤§ï¼Œæ‰€ä»¥ä½œè€…æœ‰ç‚¹ä¸å¥½å¦‚ä½•è®²è§£ï¼Œè¿˜æœ›å¤šå¤šè°…è§£ï¼Œæ–‡æœ«å°†ä¼šé™„ä¸Šguthubåœ°å€ï¼‰ï¼š
 ```
import { contentApi, contentrankApi } from '@/api'
import * as TYPE from '../actionType/contentType' //é‡‡ç”¨actionTypeä¾¿äºå¼€å‘ä¸ç®¡ç†

const state = {
	// é»˜è®¤æ’åº
	sortKeys: ['douga', 'bangumi', 'music', 'dance', 'game', 'technology', 'life', 'kichiku', 'fashion', 'ad', 'ent', 'movie', 'teleplay'],
	sortIds: [1, 13, 3, 129, 4, 36, 160, 119, 155, 165, 5, 23, 11],
	sortValues: ['åŠ¨ç”»', 'ç•ªå‰§', 'éŸ³ä¹', 'èˆè¹ˆ', 'æ¸¸æˆ', 'ç§‘æŠ€', 'ç”Ÿæ´»', 'é¬¼ç•œ', 'æ—¶å°š', 'å¹¿å‘Š', 'å¨±ä¹', 'ç”µå½±', 'TVå‰§'],
	rows: [],
	ranks: [],
	rank: {}
}

const getters = {
	rows: state => state.rows,
	sortKeys: state => state.sortKeys,
	sortIds: state => state.sortIds,
	ranks: state => state.ranks,
	rank: state => state.rank,
	sortValues: state => state.sortValues
}

const actions = {
	getContentRows({commit, state, rootState}) {
		rootState.requesting = true
		commit(TYPE.CONTENT_REQUEST)
		contentApi.content().then((response) => {
			rootState.requesting = false
			commit(TYPE.CONTENT_SUCCESS, response)
		}, (error) => {
			rootState.requesting = false
			commit(TYPE.CONTENT_FAILURE)
		})
	},
	getContentRank({commit, state, rootState}, categoryId) {
		console.log(categoryId)
		rootState.requesting = true
		commit(TYPE.CONTENT_RANK_REQUEST)
		let param = {
			categoryId: categoryId
		}
		contentrankApi.contentrank(param).then((response) => {
			rootState.requesting = false
			if (categoryId === 1) {
				console.log(response)
			}
			commit(TYPE.CONTENT_RANK_SUCCESS, response)
		}, (error) => {
			rootState.requesting = false
			commit(TYPE.CONTENT_RANK_FAILURE)
		})
	}
}
const mutations = {
	[TYPE.CONTENT_REQUEST] (state) {

	},
	[TYPE.CONTENT_SUCCESS] (state, response) {
		for (let i = 0; i < state.sortKeys.length; i++) {
			let category = state.sortKeys[i] 
			let rowItem = {
				category: category,
				categoryId: state.sortIds[i],
				name: state.sortValues[i],
				b_id: `b_${category}`,
				item: Object.values(response[category])
			}
			state.rows.push(rowItem)
		}
		},
	[TYPE.CONTENT_FAILURE] (state) {

	},

	// æ’è¡Œæ¦œä¿¡æ¯
	[TYPE.CONTENT_RANK_REQUEST] (state) {

	},
	[TYPE.CONTENT_RANK_SUCCESS] (state, response) {
		state.ranks.push(response)
		state.rank = response
	},
	[TYPE.CONTENT_RANK_FAILURE] (state) {
	
	}
}

export default {
	state,
	getters,
	actions,
	mutations
}

 ```
 
 #### 2. æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯å°±æ˜¯å¯¹æ•°æ®è¿›è¡Œåˆå§‹åŒ–ã€‚ä½œè€…å…ˆä¸Šä»£ç å†æ¥è§£é‡Šï¼Œä»£ç å¦‚ä¸‹ï¼š
 
```
import { mapGetters } from "vuex";
export default {
  mixins: [scrollMixin],
  data() {
    return {
      current: 0, //å½“å‰é€‰ä¸­æ¡ç›®çš„åºå·
      data: [], //æ•°æ®(name,element,offsetTop,height)
      time: 800, //åŠ¨ç”»æ—¶é—´
      height: 32, //å•ä¸ªå…ƒç´ çš„é«˜åº¦
      isSort: false, //æ’åºæ¨¡å¼
      scrollTop: 0, //è·ç¦»é¡µé¢çš„é¡¶éƒ¨è·ç¦»
      dragId: 0, //æ‹–æ‹½å…ƒç´ åºå·
      isDrag: false, //å½“å‰æ˜¯å¦åœ¨æ‹–æ‹½
      offsetX: 0, //é¼ æ ‡åœ¨è¦æ‹–æ‹½çš„å…ƒç´ ä¸Šçš„Xåæ ‡ä¸Šçš„åç§»
      offsetY: 0, //é¼ æ ‡åœ¨è¦æ‹–æ‹½çš„å…ƒç´ ä¸Šçš„Yåæ ‡ä¸Šçš„åç§»
      x: 0, //è¢«æ‹–æ‹½çš„å…ƒç´ åœ¨å…¶ç›¸å¯¹çš„å…ƒç´ ä¸Šçš„Xåæ ‡ä¸Šçš„åç§»
      y: 0 //è¢«æ‹–æ‹½çš„å…ƒç´ åœ¨å…¶ç›¸å¯¹çš„å…ƒç´ ä¸Šçš„Yåæ ‡ä¸Šçš„åç§»
    };
  },

```
é¦–å…ˆæˆ‘ä»¬å°†æ‰€æœ‰æˆ‘ä»¬å®ç°éœ€æ±‚æ‰€éœ€çš„æ•°æ®ï¼Œå…¨éƒ¨ç®€ç­”åˆå§‹åŒ–å†™åœ¨`data`,å¦‚æˆ‘ä»¬éœ€è¦å®ç°é¡µé¢æ»šåŠ¨æ—¶æ¡ç›®è·Ÿéšä¸“é¢˜ï¼Œå°±éœ€è¦è·å–è¿™ä¸ªæ¡ç›®çš„åºå·ï¼Œåå­—ï¼Œå…ƒç´ ä»¥åŠè·ç¦»é¡µé¢é¡¶éƒ¨çš„é«˜åº¦ç­‰ç­‰ã€‚è¦å®ç°å¯ä»¥æŠŠæ¡ç›®è¿›è¡Œæ‹–æ‹½ï¼Œå°±éœ€è¦è·å–æ˜¯å¦å‚ä¸æ‹–æ‹½çŠ¶æ€ï¼Œæ­£åœ¨æ‹–æ‹½å“ªä¸€ä¸ªæ¡ç›®ï¼Œæ‰€æœ‰éœ€è¦è·å–æ‹–æ‹½çš„æ¡ç›®åºå·ä»¥åŠé¼ æ ‡çš„ä¸€äº›æ•°æ®ã€‚
> ä»…ä»…å‘ä¸Šé¢è¿™æ ·åˆå§‹åŒ–æ•°æ®æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œè¦å®ç°éœ€æ±‚å°±å¿…é¡»åœ¨å…¼å®¹æ‰€æœ‰æµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼Œè·å–æ•´ä¸ªç½‘é¡µçš„å¤§å°å®½é«˜æ•°æ®ä»¥åŠå¯¹é¼ æ ‡çš„æ“ä½œæœ‰ç€å®æ—¶çš„ç›‘å¬ã€‚ä½œè€…å…ˆä¸Šä»£ç ï¼š

```
methods: {
    /** åˆå§‹åŒ– */
    init() {
      this.initData(); //åˆå§‹åŒ–
      this.bindEvent();
      this._screenHeight = window.screen.availHeight; //è¿”å›å½“å‰å±å¹•é«˜åº¦(ç©ºç™½ç©ºé—´) 
      this._left = this.$refs.list.getBoundingClientRect().left;//æ–¹æ³•è¿”å›å…ƒç´ çš„å¤§å°åŠå…¶ç›¸å¯¹äºè§†å£çš„ä½ç½®ã€‚
      this._top = this.$refs.list.getBoundingClientRect().top;
    },
    /** ç»‘å®šäº‹ä»¶ */
    bindEvent() {
      document.addEventListener("scroll", this.scroll, false);
      document.addEventListener("mousemove", this.dragMove, false);//å½“æŒ‡é’ˆè®¾å¤‡( é€šå¸¸æŒ‡é¼ æ ‡ )åœ¨å…ƒç´ ä¸Šç§»åŠ¨æ—¶, mousemove äº‹ä»¶è¢«è§¦å‘ã€‚
      document.addEventListener("mouseup", this.dragEnd, false);//äº‹ä»¶åœ¨æŒ‡é’ˆè®¾å¤‡æŒ‰é’®æŠ¬èµ·æ—¶è§¦å‘ã€‚
      document.addEventListener("mouseleave", this.dragEnd, false);//æŒ‡ç‚¹è®¾å¤‡ï¼ˆé€šå¸¸æ˜¯é¼ æ ‡ï¼‰çš„æŒ‡é’ˆç§»å‡ºæŸä¸ªå…ƒç´ æ—¶ï¼Œä¼šè§¦å‘mouseleaveäº‹ä»¶ã€‚
      //mouseleave  å’Œ mouseout æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æ˜¯ä¸¤è€…çš„ä¸åŒåœ¨äºmouseleave ä¸ä¼šå†’æ³¡è€Œmouseout ä¼šå†’æ³¡ã€‚
      //è¿™æ„å‘³ç€å½“æŒ‡é’ˆç¦»å¼€å…ƒç´ åŠå…¶æ‰€æœ‰åä»£æ—¶ï¼Œä¼šè§¦å‘mouseleaveï¼Œè€Œå½“æŒ‡é’ˆç¦»å¼€å…ƒç´ æˆ–ç¦»å¼€å…ƒç´ çš„åä»£ï¼ˆå³ä½¿æŒ‡é’ˆä»åœ¨å…ƒç´ å†…ï¼‰æ—¶ï¼Œä¼šè§¦å‘mouseoutã€‚
    },
    /** åˆå§‹åŒ–data */
    initData() {
      //å°†this.options.itemsè½¬åŒ–æˆæ–°çš„æ•°ç»„this.data
      this.data = Array.from(this.options.items, item => {
        let element = document.getElementById(item.b_id);
        if (!element) {
          console.error(`can not find element of name is ${item.b_id}`);
          return;
        }
        let offsetTop = this.getOffsetTop(element);
        return {
          name: item.name,
          element: element,
          offsetTop: offsetTop,//è¿”å›å½“å‰å…ƒç´ ç›¸å¯¹äºå…¶ offsetParent å…ƒç´ çš„é¡¶éƒ¨çš„è·ç¦»ã€‚
          height: element.offsetHeight//å®ƒè¿”å›è¯¥å…ƒç´ çš„åƒç´ é«˜åº¦ï¼Œé«˜åº¦åŒ…å«è¯¥å…ƒç´ çš„å‚ç›´å†…è¾¹è·å’Œè¾¹æ¡†ï¼Œä¸”æ˜¯ä¸€ä¸ªæ•´æ•°ã€‚
        };
      });
    },
    //è·å–å…ƒç´ è·ç¦»é¡¶éƒ¨çš„è·ç¦»
    getOffsetTop(element) {
      let top,
        clientTop,
        clientLeft,
        scrollTop,
        scrollLeft,
        doc = document.documentElement,//è¿”å›å…ƒç´ 
        body = document.body;
      if (typeof element.getBoundingClientRect !== "undefined") {
        top = element.getBoundingClientRect().top;
      } else {
        top = 0;
      }
      clientTop = doc.clientTop || body.clientTop || 0;//è¡¨ç¤ºä¸€ä¸ªå…ƒç´ çš„ä¸Šè¾¹æ¡†çš„å®½åº¦.boder
      scrollTop = window.pageYOffset || doc.scrollTop;//è¿”å›å½“å‰é¡µé¢ç›¸å¯¹äºçª—å£æ˜¾ç¤ºåŒºå·¦ä¸Šè§’çš„ Y ä½ç½®ã€‚æµè§ˆå™¨å…¼å®¹
      return top + scrollTop - clientTop;
    },
   }
```
- init()ï¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å¯èƒ½æ˜¯å…¨å±æˆ–è€…æ˜¯å°çª—ï¼Œæ­¤æ—¶é¡µé¢çš„å¤§å°é«˜åº¦éƒ½ä¼šæ”¹å˜ï¼Œæˆ‘ä»¬å¿…é¡»æ¯æ¬¡å½“æµè§ˆå™¨çª—å£å¤§å°å˜åŒ–æ—¶ï¼Œé‡æ–°è·å–ï¼ˆåˆå§‹åŒ–ï¼‰ï¼Œå½“å‰å±å¹•çš„é«˜åº¦ä»¥åŠæ¯ä¸ªæ¡ç›®å…ƒç´ ç›¸å¯¹çª—å£çš„ä½ç½®ï¼Œåªæœ‰è¿™æ ·æ‰å¯ä»¥åœ¨ä¸åŒçš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¸å‡ºé”™ï¼Œå®æ—¶å˜åŒ–ã€‚ä½¿ç”¨`screen.availHeight.availHeight`è·å–å±å¹•é«˜åº¦ï¼Œä½¿ç”¨`getBoundingClientRect()`æ–¹æ³•æ¥è·å–æ¡ç›®å…ƒç´ ç›¸å¯¹äºè§†çª—çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://user-gold-cdn.xitu.io/2020/4/3/1714094710cdb54d?w=240&h=238&f=jpeg&s=4821)

- bindEvent()ï¼šè¿™ä¸ªæ–¹æ³•é‡Œé¢å†™äº†å¯¹é¼ æ ‡æ“ä½œä»¥åŠæ»šåŠ¨çš„è¡Œä¸ºè¿›è¡Œäº‹ä»¶ç»‘å®šï¼Œä¹Ÿå¯è¯´ç›‘å¬ï¼Œè¿™æ˜¯å®ç°å®æ—¶å˜åŒ–çš„å…³é”®ã€‚è¿™ä¸ªæ–¹æ³•é‡Œé¢æˆ‘è¦ç‰¹åˆ«è¯´ä¸€ä¸‹çš„æ˜¯æˆ‘ä»¬ä½¿ç”¨`mouseleave`ï¼Œè€Œä¸ä½¿ç”¨`mouseout`,çš„åŸå› æ˜¯æˆ‘ä»¬éœ€è¦å®ç°è¿›è¡Œæ‹–æ‹½æ—¶ï¼Œå½“æ¡ç›®å…ƒç´ è„±å‡ºä¾§è¾¹æ ï¼Œè¿™ä¸ªå…ƒç´ å°†ä¸ä¼šæ˜¾ç¤ºäº†(ä¸‹é¢å°†æ”¾ä¸Šå±•ç¤ºåŠ¨å›¾)ï¼Œå› ä¸ºè§¦å‘äº†`mouseleave`ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å½“é¼ æ ‡ç¦»å¼€å…¶çˆ¶ç»„ä»¶æ—¶è§¦å‘ã€‚ä¸ä½¿ç”¨`mouseout`æ˜¯å› ä¸ºè¿™ä¸ªæ–¹æ³•ç¦»å¼€å…ƒç´ è‡ªå·±çš„ä½ç½®å°±ä¼šè§¦å‘ç¦»å¼€å…¶çˆ¶çº§å…ƒç´ çš„æ—¶å€™ä¹Ÿä¼šè§¦å‘ï¼Œæ˜¯å†’æ³¡è§¦å‘çš„ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€å®šè¦å‡†ç¡®ï¼Œå¦‚æœä½ è¿˜æ˜¯æœ‰ç‚¹ä¸ç†è§£ï¼Œå¯ä»¥å»è¯•è¯•MDNä¸Šçš„å¯¹æ¯”æ¼”ç¤ºdemo[æ¼”ç¤ºdemoæ–‡æ¡£](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/mouseleave_event)ã€‚

![](https://user-gold-cdn.xitu.io/2020/4/3/1714098deedd3dff?w=205&h=711&f=gif&s=269436)

- initData(): å°†`this.options.items`è½¬åŒ–æˆæ–°çš„æ•°ç»„`this.data`,è¿”å›åå­—ã€å…ƒç´ æœ¬èº«ã€å…ƒç´ ç›¸å¯¹äºå…¶ offsetParent å…ƒç´ çš„é¡¶éƒ¨çš„è·ç¦»ä»¥åŠè¯¥å…ƒç´ çš„åƒç´ é«˜åº¦ï¼Œé«˜åº¦åŒ…å«è¯¥å…ƒç´ çš„å‚ç›´å†…è¾¹è·å’Œè¾¹æ¡†ã€‚

-  getOffsetTopï¼ˆï¼‰ï¼šè·å–æ¡ç›®å…ƒç´ è·ç¦»é¡¶éƒ¨çš„è·ç¦»ï¼Œè¿™é‡Œä½œè€…ä¸è¿‡å¤šè®²è§£æ¨èä¸€ç¯‡æ–‡ç« [JavaScriptä¹‹scrollTopã€scrollHeightã€offsetTopã€offsetHeightç­‰å±æ€§å­¦ä¹ ç¬”è®°](https://www.cnblogs.com/wenruo/p/9754576.html)ã€‚éœ€è¦è®²è§£çš„æ˜¯`return top + scrollTop - clientTop;`**å…ƒç´ æœ¬èº«çš„é«˜åº¦åŠ ä¸Šæ»šåŠ¨å¢åŠ çš„é«˜åº¦å‡å»ä¸€ä¸ªé‡å¤çš„ä¸Šè¾¹æ¡†é«˜åº¦æ‰æ˜¯å®é™…çš„å…ƒç´ çš„é«˜åº¦**ã€‚
#### 3. ç°åœ¨æˆ‘ä»¬å°±è¦å¼€å§‹å®ç°ç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼Œç‚¹å‡»æ¡ç›®å…ƒç´ ï¼Œç½‘é¡µç§»åŠ¨åˆ°å¯¹åº”çš„ä½ç½®ï¼Œæˆ‘ä»¬è¦å®ç°è¿™ä¸ªåŠŸèƒ½å¾ˆå®¹æ˜“ï¼Œåªè¦è·å–å¯¹åº”æ¡ç›®å…ƒç´ çš„ä½ç½®å’Œ`index`å°±å¯ä»¥å®ç°ï¼Œä½†æ˜¯è¦å®ç°å¹³æ»‘çš„æ»šåŠ¨éœ€è¦å¼•å…¥`smooth-scroll.js`ä»£ç å¦‚ä¸‹ï¼š

```
        <div
          class="n-i sotrable"
          :class="[{'on': current===index && !isSort}, {'drag': isDrag && current === index}]"
          @click="setEnable(index)"
          @mousedown="dragStart($event, index)"
          :style="dragStyles"
          :key="index"
        >
          <div class="name">{{item.name}}</div>
        </div>
        
         <div class="btn_gotop" @click="scrollToTop(time)"></div>
         
         
    setEnable(index) {
      if (index === this.current) {
        return false;
      }
      this.current = index;
      let target = this.data[index].element;
      this.scrollToElem(target, this.time, this.offset || 0).then(() => {});
    },
```
> smooth-scroll.js

```
window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame

const Quad_easeIn = (t, b, c, d) => c * ((t = t / d - 1) * t * t + 1) + b

const scrollTo = (end, time = 800) => {
	let scrollTop = window.pageYOffset || document.documentElement.scrollTop
	let b = scrollTop
	let c = end - b
	let d = time
	let start = null

	return new Promise((resolve, reject) => {
		function step(timeStamp) {
			if (start === null) start = timeStamp
			let progress = timeStamp - start
			if (progress < time) {
				let st = Quad_easeIn(progress, b, c, d)
				document.body.scrollTop = st
				document.documentElement.scrollTop = st
				window.requestAnimationFrame(step)
			}
			else {
				document.body.scrollTop = end
				document.documentElement.scrollTop = end
				resolve(end)
			}
		}
		window.requestAnimationFrame(step)
	})
}

const scrollToTop = (time) => {
	time = typeof time === 'number' ? time : 800
	return scrollTo(0, time)
}

const scrollToElem = (elem, time, offset) => {
	let top = elem.getBoundingClientRect().top  + ( window.pageYOffset || document.documentElement.scrollTop )  - ( document.documentElement.clientTop || 0 )
	return scrollTo(top - (offset || 0), time)
}

export default {
	methods: {
		scrollToTop,
		scrollToElem,
		scrollTo
	}
}

```
å…³äº`smooth-scroll.js`,ä½œè€…æ¨èè‡ªå·±æŸ¥ä¸€ä¸‹èµ„æ–™ï¼Œæœ‰æ¯”è¾ƒå¤šã€‚

#### 4. å®ç°é¡µé¢æ»šåŠ¨æ—¶æ¡ç›®å…ƒç´ è·Ÿéšå¯¹åº”ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
     //  åç§»å€¼
    offset() {
      return this.options.offset || 100;
    },
     /** æ»šåŠ¨äº‹ä»¶ */
    scroll(e) {
      this.scrollTop =
        window.pageYOffset ||
        document.documentElement.scrollTop + document.body.scrollTop;//æµè§ˆå™¨å…¼å®¹ï¼Œè¿”å›å½“å‰é¡µé¢ç›¸å¯¹äºçª—å£æ˜¾ç¤ºåŒºå·¦ä¸Šè§’çš„ Y ä½ç½®
      if (this.scrollTop >= 300) {
        this.$refs.navSide.style.top = "0px";
        this.init();
      } else {
        this.$refs.navSide.style.top = "240px";
        this.init();
      }
      // console.log("è·ç¦»é¡¶éƒ¨" + this.scrollTop);
      //å®æ—¶è·Ÿè¸ªé¡µé¢æ»šåŠ¨
      for (let i = 0; i < this.data.length; i++) {
        if (this.scrollTop >= this.data[i].offsetTop - this.offset) {
          this.current = i;
        }
      }
    },

``` 
è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åˆå§‹åŒ–é‡Œé¢çš„æ•°æ®ï¼Œç„¶åæ»šåŠ¨çš„å…³é”®å°±æ˜¯è·å¾—å…ƒç´ åˆ°çª—å£çš„è·ç¦»ä»¥åŠåç§»å€¼ã€‚éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚æ˜¯**æ»šåŠ¨æ—¶å…ƒç´ ä¸çª—å£é¡¶éƒ¨çš„è·ç¦»å¤§äº300px**æ—¶ï¼Œæ•´ä¸ªç»„ä»¶å°†å¸é¡¶ã€‚


#### 5. å®ç°æ‹–æ‹½
> 1. è¿›å…¥æ’åºæ¨¡å¼

```
  <div class="nav-side" :class="{customizing: isSort}" ref="navSide">  <!--é»˜è®¤ä¸è¿›è¡Œæ’åº-->
    <transition name="fade">
      <div v-if="isSort">
        <div class="tip"></div>
        <div class="custom-bg"></div>
      </div>
    </transition>
 </div>
 //è¿›å…¥æ’åºæ¨¡å¼
    sort() {
      this.isSort = !this.isSort;
      this.$emit("change");
    },
    
    .fade-enter-actice, .fade-leave-active {
    transition: opacity 0.3s;
  }
  
  .fade-enter, .fade-leave-active {
    .tip {
      top: 50px;
      opacity: 0;
    }

    .custom-bg {
      top: 150px;
      left: -70px;
      height: 100px;
      width: 100px;
      opacity: 0;
    }
  }
}
```
é€šè¿‡ä¸Šé¢çš„ä»£ç å¯çŸ¥ï¼Œè¿›å…¥æ’åºæ¨¡å¼çš„ä»£ç æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯ç”±cssçš„åŠ¨ç”»æ¥å®ç°ã€‚


> 2.å¼€å§‹æ‹–æ‹½


```
/** å¾—åˆ°é¼ æ ‡ä½ç½® */
    getPos(e) {
      this.x = e.clientX - this._left - this.offsetX;
      this.y = e.clientY - this._top - this.offsetY;
    },
/** æ‹–æ‹½å¼€å§‹ */
    dragStart(e, i) {
      if (!this.isSort) return false;
      this.current = i;
      this.isDrag = true;
      this.dragId = i;
      this.offsetX = e.offsetX;
      this.offsetY = e.offsetY;
      this.getPos(e);
    },
```

å¼€å§‹æ‹–æ‹½æ—¶ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦è¿›å…¥äº†æ’åºï¼Œè¿›å…¥äº†æ‰å…è®¸å¯ä»¥è¿›è¡Œæ‹–æ‹½ï¼Œæ­¤æ—¶è·å¾—é¼ æ ‡é€‰ä¸­çš„ä½ç½®ï¼Œå…ƒç´ çš„ä½ç½®ä»¥åŠå¯¹åº”idã€‚

> 3.æ‹–æ‹½ä¸­


```
<template v-for="(item, index) in data" >
        <div
          v-if="isDrag && index === replaceItem && replaceItem <= dragId"
          class="n-i sotrable"
          :key="item.name"
        >
          <div class="name"></div>
        </div>
        <div
          class="n-i sotrable"
          :class="[{'on': current===index && !isSort}, {'drag': isDrag && current === index}]"
          @click="setEnable(index)"
          @mousedown="dragStart($event, index)"
          :style="dragStyles"
          :key="index"
        >
          <div class="name">{{item.name}}</div>
        </div>
        <div
          v-if="isDrag && index === replaceItem && replaceItem > dragId"
          class="n-i sotrable"
          :key="item.name"
        >
          <div class="name"></div>
        </div>
</template>
      
      
    // æ‹–æ‹½çš„å…ƒç´ çš„positionä¼šå˜ä¸ºabsolute,dragStylesç”¨æ¥è®¾ç½®å…¶ä½ç½®,é¼ æ ‡è¿åŠ¨æ—¶ä¼šè°ƒç”¨,ä»è€Œå®ç°è·Ÿéšé¼ æ ‡è¿åŠ¨
    dragStyles() {
      return {
        left: `${this.x}px`,
        top: `${this.y}px`
      };
    },
    //å½“è¢«æ‹–æ‹½çš„å…ƒç´ è¿åŠ¨åˆ°å…¶ä»–å…ƒç´ çš„ä½ç½®æ—¶,ä¼šä½¿å¾—replaceItemå‘é€å˜åŒ–
    replaceItem() {
      let id = Math.floor(this.y / this.height);
      if (id > this.data.length - 1) id = this.data.length;
      if (id < 0) id = 0;
      return id;
    }
    
     /** æ‹–æ‹½ä¸­ */
    dragMove(e) {
      if (this.isDrag) {
        this.getPos(e);
      }
      e.preventDefault();//è¯¥æ–¹æ³•å°†é€šçŸ¥ Web æµè§ˆå™¨ä¸è¦æ‰§è¡Œä¸äº‹ä»¶å…³è”çš„é»˜è®¤åŠ¨ä½œï¼ˆå¦‚æœå­˜åœ¨è¿™æ ·çš„åŠ¨ä½œï¼‰
    },
```

è¿›å…¥æ‹–æ‹½æ—¶ï¼Œé¦–è¦çš„æ˜¯åˆ¤æ–­æ˜¯å¦è·å–äº†è¦æ‹–æ‹½å…ƒç´ çš„é¼ æ ‡ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œå°†æ— æ³•è¿›è¡Œæ‹–æ‹½ï¼Œåˆ™ä½¿ç”¨`e.preventDefault()`é€šçŸ¥æµè§ˆå™¨ä¸è¿›è¡Œæ‹–æ‹½ã€‚ç„¶åä½¿ç”¨`dragStyles()`è·å–å…ƒç´ æ‹–æ‹½çš„å®æ—¶ä½ç½®ã€‚æœ€åå…ƒç´ æ‹–æ‹½æ—¶ä¼šæ”¹å˜å…¶ä»–å…ƒç´ çš„ä½ç½®ï¼Œä½ç½®æ”¹å˜äº†ï¼Œå…¶å¯¹åº”çš„idå°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬é€šè¿‡`replaceItem()`æ¥å®ç°ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œæˆ‘ä»¬å¥‡å¦™çš„åˆ©ç”¨**å…ƒç´ çš„å®æ—¶é«˜åº¦ä¸å…ƒç´ æœ¬èº«çš„é«˜åº¦ç›¸é™¤è·å¾—åŠ¨æ€çš„id**ã€‚

> 4. æ‹–æ‹½å®Œæˆ


```
    /** æ‹–æ‹½ç»“æŸ */
    dragEnd(e) {
      if (this.isDrag) {
        this.isDrag = false;
        if (this.replaceItem !== this.dragId) {
          this.options.items.splice(
            this.replaceItem,
            0,
            this.options.items.splice(this.dragId, 1)[0]
          );
        } else {
          this.setEnable(this.dragId, true);
        }
```
è¿™æ®µä»£ç å·§å¦™çš„æ˜¯ï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦è¿˜åœ¨è¿›è¡Œæ‹–æ‹½å¦‚æœæœ‰ï¼Œåˆ™`this.isDrag = false;`åœæ­¢æ‹–æ‹½ï¼Œæ¥ç€å°±æ˜¯æ ¸å¿ƒéƒ¨åˆ†å·§å¦™åˆ©ç”¨`splice`,å¦‚æœ`this.replaceItem !== this.dragId`,åˆ™åœ¨`this.replaceItem`åé¢æ·»åŠ ` this.options.items.splice(this.dragId, 1)[0]`,å³è¿™ä¸ªæ‹–æ‹½å…ƒç´ åˆå§‹id,ç›¸å½“äºæ‹–æ‹½ä¸æˆåŠŸï¼Œå›åˆ°åŸæ¥çš„ä½ç½®ï¼Œå¦åˆ™æ‹–æ‹½æˆåŠŸã€‚ä¸‹é¢æˆ‘ç”¨åŠ¨å›¾æ¥æ¼”ç¤ºä¸€ä¸‹ã€‚

![](https://user-gold-cdn.xitu.io/2020/4/4/171434182e434eae?w=288&h=625&f=gif&s=199437)

--------------------
### æœ€åä»Šå¤©æ˜¯æ¸…æ˜èŠ‚ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ·±åˆ‡æ‚¼å¿µæ–°å† è‚ºç‚ç–«æƒ…ç‰ºç‰²çš„çƒˆå£«å’Œé€ä¸–åŒèƒçš„æ—¥å­ï¼ŒæŠŠç½‘ç«™å˜ç°ã€‚

åœ¨å…¨å±€ä¸­åŠ ä¸Šå¦‚ä¸‹csså°±å¥½ï¼Œä»£ç å¦‚ä¸‹ï¼Œå‚è€ƒæ–‡ç« [tuitui](https://juejin.im/post/5e86e221e51d4546ce27b99c)
```
  #app 
    filter grayscale(100%)
    -webkit-filter grayscale(100%)
    -moz-filter grayscale(100%)
    -ms-filter grayscale(100%)
    -o-filter grayscale(100%)
    filter url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale")
    filter progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)
    -webkit-filter: grayscale(1)
```
æ•ˆæœå›¾ï¼š

![](https://user-gold-cdn.xitu.io/2020/4/4/171434899cf86d2a?w=1917&h=916&f=png&s=1000424)


-----------------------
### ç»“æŸ
 > æ–‡ç« çœ‹åˆ°ç°åœ¨ä¹Ÿç»“æŸå•¦ï¼Œå¦‚æœæœ‰é”™è¯¯çš„è¯å°±éº»çƒ¦å¤§å®¶ç»™æˆ‘æŒ‡å‡ºæ¥å§ï¼å¦‚æœè§‰å¾—ä¸é”™çš„è¯åˆ«å¿˜äº†ç‚¹ä¸ªèµğŸ‘å†èµ°å™¢ï¼

### æœ€åé™„ä¸ŠGithubåœ°å€
- æºç åœ°å€ï¼š[bilibili](https://github.com/zby-66/bilibili)

### ä¸ªäººåšå®¢åœ°å€

- åšå®¢åœ°å€ï¼š[å°å°æ´‹çš„åšå®¢](http://182.92.70.96/)

### æœŸå¾…

- ä½œè€…å¤§ä¸‰æ­£åœ¨å¯»æ‰¾æ˜¥æ‹›å®ä¹ ä¸­ï¼ŒæœŸå¾…å¤§ä½¬çš„é’ç~